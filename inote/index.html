<!doctype html>
<html>

    <head>
        <meta charset=utf-8>
        <meta name=description content="">
        <meta name=viewport content="width=device-width, initial-scale=1">
        <title>i Note Book list</title>
        <link href='http://fonts.googleapis.com/css?family=Cousine' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css'>

        <link rel=stylesheet href="css/inote.css">

        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script src="js/notebookstorage.js"></script>

        <script type="text/javascript">

        var storage=new NoteBookStorage();

        function buildNotebookList(data)
        {
            var key_names=data.split("\n");
            var s="";
            var last_owner="";
            var last_access="";

            for (var i=0; i<key_names.length; i++)
            {
                var key_name=key_names[i];
                var name_parts=key_name.split("/");
                if (name_parts.length<3) continue;

                var notebook_owner=name_parts[0];
                var notebook_access=name_parts[1];
                var notebook_name=name_parts[2];
                //if (access=="private" && notebook_owner!=nickname) continue

//                if (last_owner!=notebook_owner || last_access!=notebook_access){
//                    s+="<div style='padding-left: 0px;'>"+notebook_owner +" <br>"+notebook_access+"</div>";
//                    last_owner=notebook_owner;
//                    last_access=notebook_access;
//                }

                if (last_owner!=notebook_owner){
                    s+="<div style='padding-left: 0px;'>"+notebook_owner +"</div>";
                    last_owner=notebook_owner;
                }

                if (last_access!=notebook_access){
                    s+="<div  style='padding-left: 25px; color:"+(notebook_access=="private"?"black":"")+";  '>"+notebook_access+"</div>";
                    last_access=notebook_access;
                }

                s+="<div style='padding-left: 50px;'>"+
                        "<a href='inote.html?"+
                        "notebook_owner="+encodeURIComponent(notebook_owner)+
                        "&notebook_access="+encodeURIComponent(notebook_access)+
                        "&notebook_name="+encodeURIComponent(notebook_name)+
                          "'>"+notebook_name+"</a>&nbsp;&nbsp;&nbsp;"+

                        "<span class='toolButton' title='delete' onclick='deleteNotebook(\""+key_name+"\")'>&#x00D7</span>"+

                   "</div>";

            }

            $("#notebookList").html(s);
        }


        function deleteNotebook(key_name)
        {
            if (! confirm ("Sure?")) return;

            $.ajax({
                url: "/delete",
                data: {key_name: key_name},
                success:function (data){
                    location.reload();
                },
                error:function(e){
                  alert(e);
                }
            });

        }

        $(function(){
            $(".loginHolder").load("/getloginlink");
            storage.list(buildNotebookList);

            $("#btnCreate").click(function(){
                var newName="N"+(5000000+Math.floor(999000*Math.random()));
                document.location.href="inote.html?notebook_owner="+encodeURIComponent($("#userName").text())+
                        "&notebook_access="+encodeURIComponent("public")+
                        "&notebook_name="+encodeURIComponent(newName);
            });

        });

        </script>
    </head>
    <body style="padding:10px;">
        <div id="page" class="page">
            <div id="divHeader" class="header" style="padding: 0px">
                <div id="divMenu" >


                    <table cellspacing="0" cellpadding="0" style="width: 100%">
                        <tr>
                            <td style="width:100%">
                                <span id="notebookName" class="notebookName" style="font-size: 70px; font-weight: normal;"  >iNote</span>
                                <span id="btnCreate" class="toolButton" >Create new notebook</span>
                            </td>
                            <td>
                                <span class="loginHolder"></span>
                            </td>
                        </tr>

                    </table>


                </div>

            </div>
            <div id="notebookList"></div>
        </div>
    </body>
</html>
