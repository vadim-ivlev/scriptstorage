// Generated by CoffeeScript 1.7.1
(function() {
  var onsuccess, show_list, store;

  store = new NoteBookStorage();

  onsuccess = function(d) {
    console.log(d);
    if (d.error) {
      return alert(d.error);
    } else {
      return setTimeout('location.reload(true)', 100);
    }
  };

  this.deleteNotebook = function(key_name) {
    if (!confirm("Are you sure?")) {
      return;
    }
    $.ajax({
      url: "/delete",
      dataType: "json",
      data: {
        key_name: key_name
      },
      success: onsuccess,
      error: function(e) {
        return alert("error:" + e);
      }
    });
  };

  show_list = function(url, selector) {
    return $.ajax({
      url: url,
      dataType: 'json',
      success: function(d) {
        var t;
        t = $('<table class="hover compact" width="100%" ></table>');
        t.hide();
        $(selector).append(t);
        t.dataTable({
          data: d,
          paging: false,
          createdRow: function(row, d, i) {
            var a, access, name, tds, unet, x;
            unet = encodeURIComponent(d.user_name + '|' + d.user_network);
            access = encodeURIComponent(d.access);
            name = encodeURIComponent(d.notebook_name);
            tds = $(row).find('td');
            tds.first().html('');
            a = $('<a></a>');
            a.appendTo(tds.first());
            a.attr('href', "/page?owner=" + unet + "&access=" + access + "&name=" + name);
            a.text(d.notebook_name);
            tds.last().html('');
            if (true) {
              tds.last().css('text-align', 'right');
              x = $("<span class='toolButton' title='delete' >&#x00D7</span>");
              x.appendTo(tds.last());
              return x.click(function() {
                return deleteNotebook(d.key_name);
              });
            }
          },
          columns: [
            {
              title: 'Name',
              data: 'notebook_name'
            }, {
              title: 'Acc',
              data: 'access',
              width: 60
            }, {
              title: 'User',
              data: 'user_name',
              width: 120
            }, {
              title: '',
              data: 'access',
              width: 26
            }
          ]
        });
        t.show();
      }
    });
  };

  $(function() {

    /*
    loginHolder =$(".loginHolder")
     * check if login text contains python server template 
    if loginHolder.text().match(/^{{/)
        loginHolder.load "/getloginlink"
     */
    if (!$(".user_social_name").text()) {
      $('.userTab').hide();
    }
    $("#notebookList").hide();
    show_list('/publiclist', '#publicList');
    show_list('/userlist', '#userList');
    return $("#btnCreate").click(function() {
      var newName;
      newName = "N" + (5000000 + Math.floor(999000 * Math.random()));
      newName = prompt("Change the name", newName);
      if (newName) {
        return document.location.href = "/page?owner=" + encodeURIComponent($(".user_social_name").text()) + "&access=" + encodeURIComponent("public") + "&name=" + encodeURIComponent(newName);
      }
    });
  });

}).call(this);

//# sourceMappingURL=index.html.map
