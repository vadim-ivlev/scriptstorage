// Generated by CoffeeScript 1.7.1
(function() {
  var buildTable, build_delete_button, build_notebook_name_field, build_user_name_field, public_columns, showProperPane, show_list, store, user_columns;

  store = new NoteBookStorage();

  this.deleteNotebook = function(key_name) {
    if (!confirm("Are you sure?")) {
      return;
    }
    return store.del(key_name, function(d) {
      if (d.error) {
        return alert(d.error);
      } else {
        return setTimeout('location.reload(true)', 100);
      }
    }, function(err) {
      return alert("Deleting Error" + err);
    });
  };

  show_list = function(url, selector) {
    return store.get_list(url, function(d) {
      return buildTable(d, selector);
    });
  };

  public_columns = public_columns = [
    {
      title: 'Name',
      data: 'notebook_name'
    }, {
      title: 'User',
      data: 'user_name',
      width: 120
    }, {
      title: '',
      data: 'access',
      width: 26
    }
  ];

  user_columns = [
    {
      title: 'Name',
      data: 'notebook_name'
    }, {
      title: 'Acc',
      data: 'access',
      width: 60
    }, {
      title: '',
      data: 'access',
      width: 26
    }
  ];

  build_notebook_name_field = function(td, d) {
    var a, access, icon, name, unet;
    td.html('');
    unet = encodeURIComponent(d.user_name + '|' + d.user_network);
    access = encodeURIComponent(d.access);
    name = encodeURIComponent(d.notebook_name);
    a = $('<a></a>');
    a.attr('href', "/page?owner=" + unet + "&access=" + access + "&name=" + name);
    a.text(d.notebook_name);
    icon = $("<span></span>");
    if (d.notebook_name.indexOf('/') === -1) {
      icon.addClass('icon-file');
      icon.css('opacity', 0.0);
    } else {
      icon.addClass("icon-folder");
    }
    td.append(icon);
    return td.append(a);
  };

  build_delete_button = function(td, d) {
    var x;
    td.html('').css('text-align', 'right');
    if (!($(".user_name").text() === d.user_name && $('.user_network').text() === d.user_network)) {
      return '';
    }
    x = $("<span class='toolButton' title='delete' >&#x00D7</span>");
    x.click(function() {
      return deleteNotebook(d.key_name);
    });
    return td.append(x);
  };

  build_user_name_field = function(td, d) {
    if (td.text() === "public") {
      td.addClass("cell_public");
      return td.addClass("icon-eye-before");
    } else {
      return td.addClass("icon-eye-transparent");
    }
  };

  buildTable = function(d, selector) {
    var t;
    t = $('<table class="hover compact" width="100%" ></table>');
    t.hide();
    $(selector).append(t);
    t.dataTable({
      data: d,
      paging: false,
      columns: selector === "#publicList" ? public_columns : user_columns,
      createdRow: function(row, d, i) {
        var tds;
        tds = $(row).find('td');
        build_notebook_name_field(tds.first(), d);
        build_delete_button(tds.last(), d);
        if (selector === "#userList") {
          return build_user_name_field($(tds[1]), d);
        }
      }
    });
    t.show();
  };

  showProperPane = function() {
    if (!$(".user_name").text()) {
      return $('.userTab').hide();
    }
  };

  $(function() {
    $("#notebookList").hide();
    show_list('/publiclist', '#publicList');
    show_list('/userlist', '#userList');
    showProperPane();
    return $("#btnCreate").click(function() {
      var newName;
      newName = "N" + (5000000 + Math.floor(999000 * Math.random()));
      newName = prompt("Change the name", newName);
      if (newName) {
        return document.location.href = "/page?owner=" + encodeURIComponent($(".user_name").text() + "|" + $(".user_network").text()) + "&access=" + encodeURIComponent("public") + "&name=" + encodeURIComponent(newName);
      }
    });
  });

}).call(this);

//# sourceMappingURL=index.html.map
